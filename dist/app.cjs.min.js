"use strict";var global$1=void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},global=void 0!==global$1?global$1:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeGlobal$1=freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal$1||freeSelf||Function("return this")(),root$1=root,Symbol=root$1.Symbol,Symbol$1=Symbol,objectProto$e=Object.prototype,hasOwnProperty$b=objectProto$e.hasOwnProperty,nativeObjectToString$1=objectProto$e.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty$b.call(e,symToStringTag$1),r=e[symToStringTag$1];try{var a=!(e[symToStringTag$1]=void 0)}catch(e){}var n=nativeObjectToString$1.call(e);return a&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),n}var objectProto$d=Object.prototype,nativeObjectToString=objectProto$d.toString;function objectToString(e){return nativeObjectToString.call(e)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:(symToStringTag&&symToStringTag in Object(e)?getRawTag:objectToString)(e)}function isObjectLike(e){return null!=e&&"object"==typeof e}var symbolTag$1="[object Symbol]";function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&baseGetTag(e)==symbolTag$1}function arrayMap(e,t){for(var r=-1,a=null==e?0:e.length,n=Array(a);++r<a;)n[r]=t(e[r],r,e);return n}var isArray=Array.isArray,isArray$1=isArray,INFINITY$2=1/0,symbolProto$1=Symbol$1?Symbol$1.prototype:void 0,symbolToString=symbolProto$1?symbolProto$1.toString:void 0;function baseToString(e){var t;return"string"==typeof e?e:isArray$1(e)?arrayMap(e,baseToString)+"":isSymbol(e)?symbolToString?symbolToString.call(e):"":"0"==(t=e+"")&&1/e==-INFINITY$2?"-0":t}var reWhitespace=/\s/;function trimmedEndIndex(e){for(var t=e.length;t--&&reWhitespace.test(e.charAt(t)););return t}var reTrimStart=/^\s+/;function baseTrim(e){return e&&e.slice(0,trimmedEndIndex(e)+1).replace(reTrimStart,"")}function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var NAN=NaN,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if("string"!=typeof(e=isObject(e)?isObject(t="function"==typeof e.valueOf?e.valueOf():e)?t+"":t:e))return 0===e?e:+e;e=baseTrim(e);var t=reIsBinary.test(e);return t||reIsOctal.test(e)?freeParseInt(e.slice(2),t?2:8):reIsBadHex.test(e)?NAN:+e}var INFINITY$1=1/0,MAX_INTEGER=17976931348623157e292;function toFinite(e){return e?(e=toNumber(e))===INFINITY$1||e===-INFINITY$1?(e<0?-1:1)*MAX_INTEGER:e==e?e:0:0===e?e:0}function toInteger(e){var e=toFinite(e),t=e%1;return e==e?t?e-t:e:0}function identity(e){return e}var asyncTag="[object AsyncFunction]",funcTag$1="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(e){return!!isObject(e)&&((e=baseGetTag(e))==funcTag$1||e==genTag||e==asyncTag||e==proxyTag)}var coreJsData=root$1["__core-js_shared__"],coreJsData$1=coreJsData,maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData$1&&coreJsData$1.keys&&coreJsData$1.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var funcProto$2=Function.prototype,funcToString$2=funcProto$2.toString;function toSource(e){if(null!=e){try{return funcToString$2.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$c=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$a=objectProto$c.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$a).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject(e)||isMasked(e))&&(isFunction(e)?reIsNative:reIsHostCtor).test(toSource(e))}function getValue(e,t){return null==e?void 0:e[t]}function getNative(e,t){e=getValue(e,t);return baseIsNative(e)?e:void 0}var WeakMap=getNative(root$1,"WeakMap"),WeakMap$1=WeakMap,objectCreate=Object.create,baseCreate=function(){function t(){}return function(e){if(!isObject(e))return{};if(objectCreate)return objectCreate(e);t.prototype=e;e=new t;return t.prototype=void 0,e}}(),baseCreate$1=baseCreate;function apply(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function copyArray(e,t){var r=-1,a=e.length;for(t=t||Array(a);++r<a;)t[r]=e[r];return t}var HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(r){var a=0,n=0;return function(){var e=nativeNow(),t=HOT_SPAN-(e-n);if(n=e,0<t){if(++a>=HOT_COUNT)return arguments[0]}else a=0;return r.apply(void 0,arguments)}}function constant(e){return function(){return e}}var defineProperty=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),defineProperty$1=defineProperty,baseSetToString=defineProperty$1?function(e,t){return defineProperty$1(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity,baseSetToString$1=baseSetToString,setToString=shortOut(baseSetToString),setToString$1=setToString,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var r=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER$1:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&-1<e&&e%1==0&&e<t}function baseAssignValue(e,t,r){"__proto__"==t&&defineProperty$1?defineProperty$1(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function eq(e,t){return e===t||e!=e&&t!=t}var objectProto$b=Object.prototype,hasOwnProperty$9=objectProto$b.hasOwnProperty;function assignValue(e,t,r){var a=e[t];hasOwnProperty$9.call(e,t)&&eq(a,r)&&(void 0!==r||t in e)||baseAssignValue(e,t,r)}function copyObject(e,t,r,a){for(var n=!r,o=(r=r||{},-1),i=t.length;++o<i;){var s=t[o],c=a?a(r[s],e[s],s,r,e):void 0;(n?baseAssignValue:assignValue)(r,s,c=void 0===c?e[s]:c)}return r}var nativeMax$1=Math.max;function overRest(o,i,s){return i=nativeMax$1(void 0===i?o.length-1:i,0),function(){for(var e=arguments,t=-1,r=nativeMax$1(e.length-i,0),a=Array(r);++t<r;)a[t]=e[i+t];for(var t=-1,n=Array(i+1);++t<i;)n[t]=e[t];return n[i]=s(a),apply(o,this,n)}}function baseRest(e,t){return setToString$1(overRest(e,t,identity),e+"")}var MAX_SAFE_INTEGER=9007199254740991;function isLength(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=MAX_SAFE_INTEGER}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}function isIterateeCall(e,t,r){var a;return!!isObject(r)&&!!("number"==(a=typeof t)?isArrayLike(r)&&isIndex(t,r.length):"string"==a&&t in r)&&eq(r[t],e)}function createAssigner(s){return baseRest(function(e,t){var r=-1,a=t.length,n=1<a?t[a-1]:void 0,o=2<a?t[2]:void 0,n=3<s.length&&"function"==typeof n?(a--,n):void 0;for(o&&isIterateeCall(t[0],t[1],o)&&(n=a<3?void 0:n,a=1),e=Object(e);++r<a;){var i=t[r];i&&s(e,i,r,n)}return e})}var objectProto$a=Object.prototype;function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$a)}function baseTimes(e,t){for(var r=-1,a=Array(e);++r<e;)a[r]=t(r);return a}var argsTag$2="[object Arguments]";function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag$2}var objectProto$9=Object.prototype,hasOwnProperty$8=objectProto$9.hasOwnProperty,propertyIsEnumerable$1=objectProto$9.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$8.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")},isArguments$1=isArguments;function stubFalse(){return!1}var freeExports$2="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$1=moduleExports$2?root$1.Buffer:void 0,nativeIsBuffer=Buffer$1?Buffer$1.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,isBuffer$1=isBuffer,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",funcTag="[object Function]",mapTag$2="[object Map]",numberTag$1="[object Number]",objectTag$3="[object Object]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$2="[object String]",weakMapTag$1="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(t){return function(e){return t(e)}}typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag$1]=typedArrayTags[boolTag$1]=typedArrayTags[dataViewTag$2]=typedArrayTags[dateTag$1]=typedArrayTags[errorTag$1]=typedArrayTags[funcTag]=typedArrayTags[mapTag$2]=typedArrayTags[numberTag$1]=typedArrayTags[objectTag$3]=typedArrayTags[regexpTag$1]=typedArrayTags[setTag$2]=typedArrayTags[stringTag$2]=typedArrayTags[weakMapTag$1]=!1;var freeExports$1="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal$1.process,nodeUtil=function(){try{var e=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return e?e:freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeUtil$1=nodeUtil,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,isTypedArray$1=isTypedArray,objectProto$8=Object.prototype,hasOwnProperty$7=objectProto$8.hasOwnProperty;function arrayLikeKeys(e,t){var r,a=isArray$1(e),n=!a&&isArguments$1(e),o=!a&&!n&&isBuffer$1(e),i=!a&&!n&&!o&&isTypedArray$1(e),s=a||n||o||i,c=s?baseTimes(e.length,String):[],u=c.length;for(r in e)!t&&!hasOwnProperty$7.call(e,r)||s&&("length"==r||o&&("offset"==r||"parent"==r)||i&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||isIndex(r,u))||c.push(r);return c}function overArg(t,r){return function(e){return t(r(e))}}var nativeKeys=overArg(Object.keys,Object),nativeKeys$1=nativeKeys,objectProto$7=Object.prototype,hasOwnProperty$6=objectProto$7.hasOwnProperty;function baseKeys(e){if(!isPrototype(e))return nativeKeys$1(e);var t,r=[];for(t in Object(e))hasOwnProperty$6.call(e,t)&&"constructor"!=t&&r.push(t);return r}function keys(e){return(isArrayLike(e)?arrayLikeKeys:baseKeys)(e)}function nativeKeysIn(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty;function baseKeysIn(e){if(!isObject(e))return nativeKeysIn(e);var t,r=isPrototype(e),a=[];for(t in e)("constructor"!=t||!r&&hasOwnProperty$5.call(e,t))&&a.push(t);return a}function keysIn(e){return isArrayLike(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(e,t){var r;return!isArray$1(e)&&(!("number"!=(r=typeof e)&&"symbol"!=r&&"boolean"!=r&&null!=e&&!isSymbol(e))||reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t))}var nativeCreate=getNative(Object,"create"),nativeCreate$1=nativeCreate;function hashClear(){this.__data__=nativeCreate$1?nativeCreate$1(null):{},this.size=0}function hashDelete(e){e=this.has(e)&&delete this.__data__[e];return this.size-=e?1:0,e}var HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty;function hashGet(e){var t,r=this.__data__;return nativeCreate$1?(t=r[e])===HASH_UNDEFINED$2?void 0:t:hasOwnProperty$4.call(r,e)?r[e]:void 0}var objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function hashHas(e){var t=this.__data__;return nativeCreate$1?void 0!==t[e]:hasOwnProperty$3.call(t,e)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate$1&&void 0===t?HASH_UNDEFINED$1:t,this}function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}function listCacheClear(){this.__data__=[],this.size=0}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return-1}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;var arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,e=assocIndexOf(t,e);return!(e<0||(e==t.length-1?t.pop():splice.call(t,e,1),--this.size,0))}function listCacheGet(e){var t=this.__data__,e=assocIndexOf(t,e);return e<0?void 0:t[e][1]}function listCacheHas(e){return-1<assocIndexOf(this.__data__,e)}function listCacheSet(e,t){var r=this.__data__,a=assocIndexOf(r,e);return a<0?(++this.size,r.push([e,t])):r[a][1]=t,this}function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map=getNative(root$1,"Map"),Map$1=Map;function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData(e,t){e=e.__data__;return isKeyable(t)?e["string"==typeof t?"string":"hash"]:e.map}function mapCacheDelete(e){e=getMapData(this,e).delete(e);return this.size-=e?1:0,e}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var r=getMapData(this,e),a=r.size;return r.set(e,t),this.size+=r.size==a?0:1,this}function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var FUNC_ERROR_TEXT="Expected a function";function memoize(a,n){if("function"!=typeof a||null!=n&&"function"!=typeof n)throw new TypeError(FUNC_ERROR_TEXT);function o(){var e=arguments,t=n?n.apply(this,e):e[0],r=o.cache;return r.has(t)?r.get(t):(e=a.apply(this,e),o.cache=r.set(t,e)||r,e)}return o.cache=new(memoize.Cache||MapCache),o}memoize.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(e){var e=memoize(e,function(e){return t.size===MAX_MEMOIZE_SIZE&&t.clear(),e}),t=e.cache;return e}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped(function(e){var n=[];return 46===e.charCodeAt(0)&&n.push(""),e.replace(rePropName,function(e,t,r,a){n.push(r?a.replace(reEscapeChar,"$1"):t||e)}),n}),stringToPath$1=stringToPath;function toString(e){return null==e?"":baseToString(e)}function castPath(e,t){return isArray$1(e)?e:isKey(e,t)?[e]:stringToPath$1(toString(e))}var INFINITY=1/0;function toKey(e){var t;return"string"==typeof e||isSymbol(e)?e:"0"==(t=e+"")&&1/e==-INFINITY?"-0":t}function baseGet(e,t){for(var r=0,a=(t=castPath(t,e)).length;null!=e&&r<a;)e=e[toKey(t[r++])];return r&&r==a?e:void 0}function get(e,t,r){e=null==e?void 0:baseGet(e,t);return void 0===e?r:e}function arrayPush(e,t){for(var r=-1,a=t.length,n=e.length;++r<a;)e[n+r]=t[r];return e}var spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable(e){return isArray$1(e)||isArguments$1(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}function baseFlatten(e,t,r,a,n){var o=-1,i=e.length;for(r=r||isFlattenable,n=n||[];++o<i;){var s=e[o];0<t&&r(s)?1<t?baseFlatten(s,t-1,r,a,n):arrayPush(n,s):a||(n[n.length]=s)}return n}var getPrototype=overArg(Object.getPrototypeOf,Object),getPrototype$1=getPrototype,objectTag$2="[object Object]",funcProto=Function.prototype,objectProto$3=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$2=objectProto$3.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject(e){return!(!isObjectLike(e)||baseGetTag(e)!=objectTag$2)&&(null===(e=getPrototype$1(e))||"function"==typeof(e=hasOwnProperty$2.call(e,"constructor")&&e.constructor)&&e instanceof e&&funcToString.call(e)==objectCtorString)}function baseSlice(e,t,r){for(var a=-1,n=e.length,o=((r=n<r?n:r)<0&&(r+=n),n=r<(t=t<0?n<-t?0:n+t:t)?0:r-t>>>0,t>>>=0,Array(n));++a<n;)o[a]=e[a+t];return o}var nativeCeil=Math.ceil,nativeMax=Math.max;function chunk(e,t,r){t=(r?isIterateeCall(e,t,r):void 0===t)?1:nativeMax(toInteger(t),0);var a=null==e?0:e.length;if(!a||t<1)return[];for(var n=0,o=0,i=Array(nativeCeil(a/t));n<a;)i[o++]=baseSlice(e,n,n+=t);return i}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,e=t.delete(e);return this.size=t.size,e}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE=200;function stackSet(e,t){var r=this.__data__;if(r instanceof ListCache){var a=r.__data__;if(!Map$1||a.length<LARGE_ARRAY_SIZE-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(a)}return r.set(e,t),this.size=r.size,this}function Stack(e){e=this.__data__=new ListCache(e);this.size=e.size}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer=moduleExports?root$1.Buffer:void 0,allocUnsafe=Buffer?Buffer.allocUnsafe:void 0;function cloneBuffer(e,t){return t?e.slice():(t=e.length,t=allocUnsafe?allocUnsafe(t):new e.constructor(t),e.copy(t),t)}function arrayFilter(e,t){for(var r=-1,a=null==e?0:e.length,n=0,o=[];++r<a;){var i=e[r];t(i,r,e)&&(o[n++]=i)}return o}function stubArray(){return[]}var objectProto$2=Object.prototype,propertyIsEnumerable=objectProto$2.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols?function(t){return null==t?[]:(t=Object(t),arrayFilter(nativeGetSymbols(t),function(e){return propertyIsEnumerable.call(t,e)}))}:stubArray,getSymbols$1=getSymbols;function baseGetAllKeys(e,t,r){t=t(e);return isArray$1(e)?t:arrayPush(t,r(e))}function getAllKeys(e){return baseGetAllKeys(e,keys,getSymbols$1)}var DataView=getNative(root$1,"DataView"),DataView$1=DataView,Promise$1=getNative(root$1,"Promise"),Promise$2=Promise$1,Set=getNative(root$1,"Set"),Set$1=Set,mapTag$1="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag$1="[object Set]",weakMapTag="[object WeakMap]",dataViewTag$1="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$2),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag=baseGetTag,getTag$1=getTag=DataView$1&&getTag(new DataView$1(new ArrayBuffer(1)))!=dataViewTag$1||Map$1&&getTag(new Map$1)!=mapTag$1||Promise$2&&getTag(Promise$2.resolve())!=promiseTag||Set$1&&getTag(new Set$1)!=setTag$1||WeakMap$1&&getTag(new WeakMap$1)!=weakMapTag?function(e){var t=baseGetTag(e),e=t==objectTag$1?e.constructor:void 0,e=e?toSource(e):"";if(e)switch(e){case dataViewCtorString:return dataViewTag$1;case mapCtorString:return mapTag$1;case promiseCtorString:return promiseTag;case setCtorString:return setTag$1;case weakMapCtorString:return weakMapTag}return t}:getTag,Uint8Array=root$1.Uint8Array,Uint8Array$1=Uint8Array;function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Uint8Array$1(t).set(new Uint8Array$1(e)),t}function cloneTypedArray(e,t){t=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}function initCloneObject(e){return"function"!=typeof e.constructor||isPrototype(e)?{}:baseCreate$1(getPrototype$1(e))}var HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED),this}function setCacheHas(e){return this.__data__.has(e)}function SetCache(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new MapCache;++t<r;)this.add(e[t])}function arraySome(e,t){for(var r=-1,a=null==e?0:e.length;++r<a;)if(t(e[r],r,e))return!0;return!1}function cacheHas(e,t){return e.has(t)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays(e,t,r,a,n,o){var i=r&COMPARE_PARTIAL_FLAG$5,s=e.length,c=t.length;if(s!=c&&!(i&&s<c))return!1;var c=o.get(e),u=o.get(t);if(c&&u)return c==t&&u==e;var l=-1,p=!0,f=r&COMPARE_UNORDERED_FLAG$3?new SetCache:void 0;for(o.set(e,t),o.set(t,e);++l<s;){var y,g=e[l],d=t[l];if(void 0!==(y=a?i?a(d,g,l,t,e,o):a(g,d,l,e,t,o):y)){if(y)continue;p=!1;break}if(f){if(!arraySome(t,function(e,t){if(!cacheHas(f,t)&&(g===e||n(g,e,r,a,o)))return f.push(t)})){p=!1;break}}else if(g!==d&&!n(g,d,r,a,o)){p=!1;break}}return o.delete(e),o.delete(t),p}function mapToArray(e){var r=-1,a=Array(e.size);return e.forEach(function(e,t){a[++r]=[t,e]}),a}function setToArray(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag$1="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag(e,t,r,a,n,o,i){switch(r){case dataViewTag:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag:return e.byteLength==t.byteLength&&o(new Uint8Array$1(e),new Uint8Array$1(t))?!0:!1;case boolTag:case dateTag:case numberTag:return eq(+e,+t);case errorTag:return e.name==t.name&&e.message==t.message;case regexpTag:case stringTag$1:return e==t+"";case mapTag:var s=mapToArray;case setTag:s=s||setToArray;if(e.size!=t.size&&!(a&COMPARE_PARTIAL_FLAG$4))return!1;var c=i.get(e);if(c)return c==t;a|=COMPARE_UNORDERED_FLAG$2,i.set(e,t);c=equalArrays(s(e),s(t),a,n,o,i);return i.delete(e),c;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var COMPARE_PARTIAL_FLAG$3=1,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function equalObjects(e,t,r,a,n,o){var i=r&COMPARE_PARTIAL_FLAG$3,s=getAllKeys(e),c=s.length;if(c!=getAllKeys(t).length&&!i)return!1;for(var u=c;u--;){var l=s[u];if(!(i?l in t:hasOwnProperty$1.call(t,l)))return!1}var p=o.get(e),f=o.get(t);if(p&&f)return p==t&&f==e;for(var y=!0,g=(o.set(e,t),o.set(t,e),i);++u<c;){var d,h=e[l=s[u]],b=t[l];if(!(void 0===(d=a?i?a(b,h,l,t,e,o):a(h,b,l,e,t,o):d)?h===b||n(h,b,r,a,o):d)){y=!1;break}g=g||"constructor"==l}return y&&!g&&(p=e.constructor)!=(f=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof p&&p instanceof p&&"function"==typeof f&&f instanceof f)&&(y=!1),o.delete(e),o.delete(t),y}var COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function baseIsEqualDeep(e,t,r,a,n,o){var i=isArray$1(e),s=isArray$1(t),c=i?arrayTag:getTag$1(e),s=s?arrayTag:getTag$1(t),u=(c=c==argsTag?objectTag:c)==objectTag,l=(s=s==argsTag?objectTag:s)==objectTag,s=c==s;if(s&&isBuffer$1(e)){if(!isBuffer$1(t))return!1;u=!(i=!0)}if(s&&!u)return o=o||new Stack,i||isTypedArray$1(e)?equalArrays(e,t,r,a,n,o):equalByTag(e,t,c,r,a,n,o);if(!(r&COMPARE_PARTIAL_FLAG$2)){i=u&&hasOwnProperty.call(e,"__wrapped__"),c=l&&hasOwnProperty.call(t,"__wrapped__");if(i||c)return n(i?e.value():e,c?t.value():t,r,a,o=o||new Stack)}return s&&equalObjects(e,t,r,a,n,o=o||new Stack)}function baseIsEqual(e,t,r,a,n){return e===t||(null==e||null==t||!isObjectLike(e)&&!isObjectLike(t)?e!=e&&t!=t:baseIsEqualDeep(e,t,r,a,baseIsEqual,n))}var COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch(e,t,r,a){var n=r.length,o=n,i=!a;if(null==e)return!o;for(e=Object(e);n--;){var s=r[n];if(i&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++n<o;){var c=(s=r[n])[0],u=e[c],l=s[1];if(i&&s[2]){if(void 0===u&&!(c in e))return!1}else{var p,f=new Stack;if(!(void 0===(p=a?a(u,l,c,e,t,f):p)?baseIsEqual(l,u,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,a,f):p))return!1}}return!0}function isStrictComparable(e){return e==e&&!isObject(e)}function getMatchData(e){for(var t=keys(e),r=t.length;r--;){var a=t[r],n=e[a];t[r]=[a,n,isStrictComparable(n)]}return t}function matchesStrictComparable(t,r){return function(e){return null!=e&&e[t]===r&&(void 0!==r||t in Object(e))}}function baseMatches(t){var r=getMatchData(t);return 1==r.length&&r[0][2]?matchesStrictComparable(r[0][0],r[0][1]):function(e){return e===t||baseIsMatch(e,t,r)}}function baseHasIn(e,t){return null!=e&&t in Object(e)}function hasPath(e,t,r){for(var a=-1,n=(t=castPath(t,e)).length,o=!1;++a<n;){var i=toKey(t[a]);if(!(o=null!=e&&r(e,i)))break;e=e[i]}return o||++a!=n?o:!!(n=null==e?0:e.length)&&isLength(n)&&isIndex(i,n)&&(isArray$1(e)||isArguments$1(e))}function hasIn(e,t){return null!=e&&hasPath(e,t,baseHasIn)}var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty(r,a){return isKey(r)&&isStrictComparable(a)?matchesStrictComparable(toKey(r),a):function(e){var t=get(e,r);return void 0===t&&t===a?hasIn(e,r):baseIsEqual(a,t,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseProperty(t){return function(e){return null==e?void 0:e[t]}}function basePropertyDeep(t){return function(e){return baseGet(e,t)}}function property(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}function baseIteratee(e){return"function"==typeof e?e:null==e?identity:"object"==typeof e?isArray$1(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}function createBaseFor(c){return function(e,t,r){for(var a=-1,n=Object(e),o=r(e),i=o.length;i--;){var s=o[c?i:++a];if(!1===t(n[s],s,n))break}return e}}var baseFor=createBaseFor(),baseFor$1=baseFor;function baseForOwn(e,t){return e&&baseFor$1(e,t,keys)}function createBaseEach(o,i){return function(e,t){if(null!=e){if(!isArrayLike(e))return o(e,t);for(var r=e.length,a=i?r:-1,n=Object(e);(i?a--:++a<r)&&!1!==t(n[a],a,n););}return e}}var baseEach=createBaseEach(baseForOwn),baseEach$1=baseEach;function assignMergeValue(e,t,r){(void 0===r||eq(e[t],r))&&(void 0!==r||t in e)||baseAssignValue(e,t,r)}function isArrayLikeObject(e){return isObjectLike(e)&&isArrayLike(e)}function safeGet(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function toPlainObject(e){return copyObject(e,keysIn(e))}function baseMergeDeep(e,t,r,a,n,o,i){var s,c,u,l=safeGet(e,r),p=safeGet(t,r),f=i.get(p);f||((t=void 0===(f=o?o(l,p,r+"",e,t,i):void 0))&&(c=!(s=isArray$1(p))&&isBuffer$1(p),u=!s&&!c&&isTypedArray$1(p),f=p,s||c||u?f=isArray$1(l)?l:isArrayLikeObject(l)?copyArray(l):c?cloneBuffer(p,!(t=!1)):u?cloneTypedArray(p,!(t=!1)):[]:isPlainObject(p)||isArguments$1(p)?isArguments$1(f=l)?f=toPlainObject(l):isObject(l)&&!isFunction(l)||(f=initCloneObject(p)):t=!1),t&&(i.set(p,f),n(f,p,a,o,i),i.delete(p))),assignMergeValue(e,r,f)}function baseMerge(a,n,o,i,s){a!==n&&baseFor$1(n,function(e,t){var r;s=s||new Stack,isObject(e)?baseMergeDeep(a,n,t,o,baseMerge,i,s):(r=i?i(safeGet(a,t),e,t+"",a,n,s):void 0,assignMergeValue(a,t,r=void 0===r?e:r))},keysIn)}function baseMap(e,a){var n=-1,o=isArrayLike(e)?Array(e.length):[];return baseEach$1(e,function(e,t,r){o[++n]=a(e,t,r)}),o}var stringTag="[object String]";function isString(e){return"string"==typeof e||!isArray$1(e)&&isObjectLike(e)&&baseGetTag(e)==stringTag}var merge=createAssigner(function(e,t,r){baseMerge(e,t,r)}),merge$1=merge;function baseSortBy(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}function compareAscending(e,t){if(e!==t){var r=void 0!==e,a=null===e,n=e==e,o=isSymbol(e),i=void 0!==t,s=null===t,c=t==t,u=isSymbol(t);if(!s&&!u&&!o&&t<e||o&&i&&c&&!s&&!u||a&&i&&c||!r&&c||!n)return 1;if(!a&&!o&&!u&&e<t||u&&r&&n&&!a&&!o||s&&r&&n||!i&&n||!c)return-1}return 0}function compareMultiple(e,t,r){for(var a=-1,n=e.criteria,o=t.criteria,i=n.length,s=r.length;++a<i;){var c=compareAscending(n[a],o[a]);if(c)return s<=a?c:c*("desc"==r[a]?-1:1)}return e.index-t.index}function baseOrderBy(e,a,r){a=a.length?arrayMap(a,function(t){return isArray$1(t)?function(e){return baseGet(e,1===t.length?t[0]:t)}:t}):[identity];var n=-1;return a=arrayMap(a,baseUnary(baseIteratee)),baseSortBy(baseMap(e,function(t,e,r){return{criteria:arrayMap(a,function(e){return e(t)}),index:++n,value:t}}),function(e,t){return compareMultiple(e,t,r)})}var nativeFloor=Math.floor,nativeRandom$1=Math.random;function baseRandom(e,t){return e+nativeFloor(nativeRandom$1()*(t-e+1))}var freeParseFloat=parseFloat,nativeMin=Math.min,nativeRandom=Math.random;function random(e,t,r){var a;return r&&"boolean"!=typeof r&&isIterateeCall(e,t,r)&&(t=r=void 0),void 0===r&&("boolean"==typeof t?(r=t,t=void 0):"boolean"==typeof e&&(r=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=toFinite(e),void 0===t?(t=e,e=0):t=toFinite(t)),t<e&&(a=e,e=t,t=a),r||e%1||t%1?(a=nativeRandom(),nativeMin(e+a*(t-e+freeParseFloat("1e-"+((a+"").length-1))),t)):baseRandom(e,t)}var sortBy=baseRest(function(e,t){var r;return null==e?[]:(1<(r=t.length)&&isIterateeCall(e,t[0],t[1])?t=[]:2<r&&isIterateeCall(t[0],t[1],t[2])&&(t=[t[0]]),baseOrderBy(e,baseFlatten(t,1),[]))}),sortBy$1=sortBy;const toBin=e=>parseInt(e).toString(2),fromBin=e=>parseInt(e,2),fromBinToBase32=e=>parseInt(e,2).toString(32),toBase32=e=>parseInt(e).toString(32),fromBase32=e=>parseInt(e,32),fromBase32ToBin=e=>parseInt(e,32).toString(2),chars=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"].join(""),vowels=["a","e","i","o","u"].join(""),alphanum=["0","1","2","3","4","5","6","7","8","9",...chars.split("")].join(""),randomChar=(e=1)=>{e=new Array(e).fill(0).map(()=>chars[randomInt(0,chars.length)]);return shuffleStr(e).join("")},randomAlpha=(e=1,t=alphanum.length)=>{e=new Array(e).fill(0).map(()=>alphanum[randomInt(0,t)]);return shuffleStr(e).join("")};class Base{static charToBin(e){return fromBase32ToBin(e).padStart(5,"0")}static targetTypes(e,t=null){return(t||["sensor","neuron","action"])[e]||"neuron"}static getConfig(e=""){var e={config:this.charToBin(e[0])},[t,[r]]=chunk(e.config.split(""),4),r=("0"===(e.type=r)?e.type="connection":"1"===r&&(e.type="bias"),"bias"===e.type?t.pop():void 0);return e.data=fromBin(t.join("")),"1"===r&&(e.data*=-1),e}static getTarget(e="",t=1,r=null){let a=e.split("").map(e=>this.charToBin(e));var[e,t]=chunk(a=a.join("").split(""),a.length-t);return{id:fromBin(e.join("")),type:this.targetTypes(fromBin(t.join("")),r)}}static fromString(e=""){e={encoded:e};return"bias"===(e=merge$1(e,this.getConfig(e.encoded[0]))).type?(e.encoded=e.encoded.padEnd(3,"0"),e.target=this.getTarget(e.encoded[1]+e.encoded[2],2)):"connection"===e.type&&(e.encoded=e.encoded.padEnd(5,"0"),e.source=this.getTarget(e.encoded[1]+e.encoded[2],1,["sensor","neuron"]),e.target=this.getTarget(e.encoded[3]+e.encoded[4],1,["neuron","action"])),delete e.config,e}static toString(e){let t="";return"bias"===e.type?(t+=Math.abs(e.data).toString(2).padStart(3,"0"),0<=e.data?t+="0":t+="1",t=(t+="1")+e.target.id.toString(2).padStart(8,"0"),"sensor"===e.target.type?t+="00":"neuron"!==e.target.type&&"action"===e.target.type?t+="10":t+="01"):"connection"===e.type&&(t=(t=t+Math.abs(e.data).toString(2).padStart(4,"0")+"0")+e.source.id.toString(2).padStart(9,"0"),"sensor"===e.source.type?t+="0":(e.source.type,t+="1"),t+=e.target.id.toString(2).padStart(9,"0"),"neuron"!==e.target.type&&"action"===e.target.type?t+="1":t+="0"),chunk(t,5).map(e=>fromBinToBase32(e.join(""))).join("").toUpperCase()}static random(){return random(0,10)<5?{type:"bias",data:random(0,4),target:{id:random(1,100),type:["sensor","neuron","action"][random(0,2)]}}:{type:"connection",data:random(0,4),source:{type:["sensor","neuron","action"][random(0,2)],id:random(1,100)},target:{type:["sensor","neuron","action"][random(0,2)],id:random(1,100)}}}static randomString(){return this.toString(this.random())}static randomWith({neurons:e=1,sensors:t=1,actions:r=1}={}){if(random(0,100)<25){const a=random(-3,3);return random(0,100)<33?{type:"bias",data:a,target:{type:"sensor",id:random(0,t-1)}}:random(0,100)<50?{type:"bias",data:a,target:{type:"neuron",id:random(0,e-1)}}:{type:"bias",data:a,target:{type:"sensor",id:random(0,r-1)}}}const a=random(0,4);return random(0,100)<50?{type:"connection",data:a,source:{type:"sensor",id:random(0,t-1)},target:{type:"neuron",id:random(0,e-1)}}:{type:"connection",data:a,source:{type:"neuron",id:random(0,e-1)},target:{type:"action",id:random(0,r-1)}}}}class Genome{static from(e){return isString(e)?this.fromString(e):isArray$1(e)?this.fromBases(e):e}static fromString(e=""){for(var t={encoded:(e||"").toUpperCase().trim(),bases:[]},r=e.split("");0<r.length;){let e=r.shift();var a=Base.fromString(e);"bias"===a.type?e=(e+=r.shift()||"")+(r.shift()||""):"connection"===a.type&&(e=(e=(e=(e+=r.shift()||"")+(r.shift()||""))+(r.shift()||""))+(r.shift()||"")),e=Base.fromString(e.trim()),t.bases.push(e)}return t}static fromBases(e){return{bases:e,encoded:e.map(e=>Base.toString(e)).join("")}}static toString(e){return e.map(e=>Base.toString(e)).join("")}static random(e=1){e=new Array(e).fill(null).map(()=>Base.random());return{bases:e,encoded:e.map(e=>Base.toString(e)).join("")}}static randomWith(e=1,{neurons:t=1,sensors:r=1,actions:a=1}={}){e=new Array(e).fill(null).map(()=>Base.randomWith({neurons:t,sensors:r,actions:a}));return{bases:e,encoded:e.map(e=>Base.toString(e)).join("")}}}function dotProduct(e,a){return e.reduce((e,t,r)=>e+t*a[r],0)}class Vertex{constructor(e,t={}){this.name=e,this.metadata={...t},this.in=[],this.inMap={},this.out=[],this.outMap={}}addIn(e,t){this.inMap[e.name]?(this.inMap[e.name].weight+=t,this.in[this.inMap[e.name].index].weight+=t):this.inMap[e.name]={weight:t,index:this.in.push({vertex:e,weight:t})-1}}addOut(e,t){this.outMap[e.name]?(this.outMap[e.name].weight+=t,this.out[this.outMap[e.name].index].weight+=t):this.outMap[e.name]={weight:t,index:this.out.push({vertex:e,weight:t})-1}}neighbors(e=null){return e?this.in.filter(e).concat(this.out.filter(e)):this.in.concat(this.out)}toJSON(){return{name:this.name,metadata:this.metadata,in:this.in.map(e=>e.vertex.name),out:this.out.map(e=>e.vertex.name)}}toString(){return JSON.stringify(this.toJSON(),null,2)}inputsTree(t=0,r={}){if(r[this.name])return[];let a=[];r[this.name]=a.push({deph:t,vertex:this});for(const n of this.in){let e=n.vertex.inputsTree(t+1,r);e=e.filter(e=>!r[e.name]),a=a.concat(e)}return sortBy$1(a,["deph"])}calculateInput(){var e,t,r=[],a=[];for({vertex:e,weight:t}of this.in)r.push(e.metadata.lastTick||0),a.push(t);return dotProduct(r,a)}}function sigmoid(e=0){return 1/(1+Math.exp(-1*e))}function relu(e=0){return Math.max(0,e)}class Brain{constructor({genome:e,sensors:t=[],actions:r=[],environment:a={},activationFunction:n="relu"}){this.environment=a,this.genome=Genome.from(e),this.activationFunction="sigmoid"===n?sigmoid:relu,this.definitions={all:{},actions:{},neurons:{},sensors:{}},this.sensors=t.reduce((e,t,r)=>(t.name||(t.name="s#"+(t.id||r)),e[t.name]=t,e),{}),this.actions=r.reduce((e,t,r)=>(t.name||(t.name="a#"+(t.id||r)),e[t.name]=t,e),{}),this.tickOrder=[],this.setup()}setup(){for(const e of this.genome.bases)"bias"===e.type?this.setupBias(e):"connection"===e.type&&this.setupConnection(e);this.tickOrder=this.defineTickOrder();const r=this.environment,a=this.activationFunction;for(const n of Object.values(this.definitions.sensors)){let t=this.sensors[n.name]?.tick||(()=>0);t=t.bind(r.me||this),n.tick=function(){var e=t(r)+(this.metadata.bias||0);return this.metadata.lastTick=e}}for(const t of Object.values(this.definitions.neurons))t.tick=function(){var e=this.calculateInput(),e=a(e+(this.metadata.bias||0));return this.metadata.lastTick=e};for(const o of Object.values(this.definitions.actions)){let t=this.actions[o.name]?.tick||(()=>0);t=t.bind(r.me||this),o.tick=function(){var e=this.calculateInput(),e=a(e+(this.metadata.bias||0)),e=t(e,r);return this.metadata.lastTick=e}}}setupBias({target:e,data:t}){this.findOrCreateVertex({id:e.id,collection:e.type+"s",metadata:{bias:t||0,type:e.type}})}setupConnection({data:e,source:t,target:r}){t=this.findOrCreateVertex({id:t.id,collection:t.type+"s",metadata:{type:t.type}}),r=this.findOrCreateVertex({id:r.id,collection:r.type+"s",metadata:{type:r.type}});r.addIn(t,e),t.addOut(r,e)}findOrCreateVertex({id:e,collection:t,metadata:r}){return this.definitions[t][e]?(this.definitions[t][e].metadata.bias=this.definitions[t][e].metadata.bias+(r.bias||0),this.definitions[t][e]):(r=new Vertex(t[0]+"#"+e,{bias:0,...r,id:e}),this.definitions[t][e]=r,this.definitions.all[r.name]=r)}defineTickOrder(){let e=[];for(const t of Object.values(this.definitions.actions).filter(e=>0<e.in.length))e=e.concat(t.inputsTree()),e=sortBy$1(e,["deph"]).reverse();return e}tick(){var e,t={},r={sensor:[],neuron:[],action:[]};for({vertex:e}of this.tickOrder)r[e.metadata.type].push(e);for(const o of r.sensor)t[o.name]||(t[o.name]=o.tick());for(const i of r.neuron)t[i.name]||(t[i.name]=i.tick());var a=[];for(const s of r.action)t[s.name]||a.push({input:s.calculateInput(),vertex:s});var n=sortBy$1(a,["input"]).pop().vertex;return t[n.name]=n.tick(),t}}class Reproduction{static genomeMutate(e,t=.001){var r;return isString(e)?(r=e.split("").map(e=>Math.random()>t?e:random(0,31).toString(32).toUpperCase()).join(""),Genome.fromString(r)):(r=e.bases.map(e=>Math.random()>t?e:Base.random()),Genome.fromBases(r))}}class Individual{constructor({genome:e=null,sensors:t=[],actions:r=[],environment:a={}}){this.genome=Genome.from(e);const n=merge$1({me:this},a);this.brain=new Brain({sensors:t,actions:r,genome:this.genome,environment:n}),this.reproduce={asexual:{fission:(e=.001)=>new Individual({sensors:t,actions:r,environment:n,genome:Reproduction.genomeMutate(this.genome,e)})}}}tick(){return this.brain.tick()}}exports.Base=Base,exports.Brain=Brain,exports.Genome=Genome,exports.Individual=Individual,exports.Reproduction=Reproduction,exports.Vertex=Vertex,exports.alphanum=alphanum,exports.chars=chars,exports.fromBase32=fromBase32,exports.fromBase32ToBin=fromBase32ToBin,exports.fromBin=fromBin,exports.fromBinToBase32=fromBinToBase32,exports.randomAlpha=randomAlpha,exports.randomChar=randomChar,exports.toBase32=toBase32,exports.toBin=toBin,exports.vowels=vowels;
